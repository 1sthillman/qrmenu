KODLARDA LÄ°NTER HATASI VS OLURSA ONU DÃœZELTMEDEN Ä°LERLEME### ğŸš€ Cursor AI KurallarÄ±: Adisyon UygulamasÄ± (Supabase Realtime)

#### âš ï¸ **BU YAP, BU YAPMA** FormatÄ±nda Kritik Kurallar

---

#### ğŸ” **AUTHENTICATION & ROL YÃ–NETÄ°MÄ°**
```javascript
// BU YAP
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY, {
  auth: { persistSession: false } // Oturum sÃ¼rekliliÄŸi kapat
});

// BU YAP
const login = async (rol, sifre) => {
  if (
    (rol === "garson" && sifre === "garson123") ||
    (rol === "mutfak" && sifre === "mutfak123") ||
    (rol === "kasiyer" && sifre === "kasiyer123")
  ) {
    localStorage.setItem("currentRole", rol);
    return true;
  }
  return false;
};

// BU YAPMA
// Supabase built-in auth KULLANMA (Åifreler sabit)
```

---

#### ğŸª‘ **MASA YÃ–NETÄ°MÄ° (100 Masa)**
```javascript
// BU YAP
const TABLE_COLORS = {
  bos: "#CCCCCC",
  aktif: "#2196F3",
  hazir: "#4CAF50",
  teslim_alindi: "#FF9800",
  servis_edildi: "#9C27B0"
};

// BU YAP
// Masa durum deÄŸiÅŸimlerinde tetikleyici
supabase
  .channel("masa-durum")
  .on("postgres_changes", { event: "UPDATE", schema: "public", table: "masalar" }, (payload) => {
    updateTableUI(payload.new);
  })
  .subscribe();

// BU YAPMA
// Masa durumunu client-side'da saklama (Sadece DB'den oku)
```

---

#### ğŸ“¦ **SÄ°PARÄ°Å YÃ–NETÄ°MÄ° (Kritik MantÄ±klar)**
```javascript
// BU YAP - YENÄ° SÄ°PARÄ°Å
const yeniSiparis = async (masaId, urunler, notlar) => {
  const { error } = await supabase.from("siparisler").insert({
    masa_id: masaId,
    urunler: JSON.stringify(urunler), // {1:2, 5:1} format
    notlar,
    durum: "bekliyor",
    is_ek_siparis: (await getMasaDurum(masaId)) === "servis_edildi"
  });

  // BU YAP - MASA DURUM GÃœNCELLE
  if (!error) {
    await supabase
      .from("masalar")
      .update({ durum: "aktif" })
      .eq("id", masaId);
  }
};

// BU YAP - EK SÄ°PARÄ°Å KORUMASI
const siparisOnayla = async (siparisId) => {
  const siparis = await getSiparis(siparisId);
  
  if (siparis.is_ek_siparis) {
    // SADECE YENÄ° ÃœRÃœNLERÄ° MUTFAÄA GÃ–NDER
    await notifyKitchen(siparis.urunler);
  }
};

// BU YAPMA
// Eski sipariÅŸleri mutfaÄŸa tekrar gÃ¶nderme
```

---

#### ğŸ‘¨â€ğŸ³ **MUTFAK PANELÄ° Ä°Å AKIÅI**
```javascript
// BU YAP - GERÃ‡EK ZAMANLI SÄ°PARÄ°Å ALIMI
supabase
  .channel("yeni-siparisler")
  .on("postgres_changes", { event: "INSERT", table: "siparisler" }, (payload) => {
    if (payload.new.durum === "bekliyor") {
      addToKitchenQueue(payload.new);
    }
  })
  .subscribe();

// BU YAP - HAZIRLAMA TAMAMLANDIÄINDA
const siparisHazir = async (siparisId) => {
  const { data } = await supabase
    .from("siparisler")
    .update({ durum: "hazir" })
    .eq("id", siparisId)
    .select("masa_id")
    .single();

  // MASA DURUMUNU GÃœNCELLE
  await supabase
    .from("masalar")
    .update({ durum: "hazir" })
    .eq("id", data.masa_id);
};

// BU YAPMA
// HazÄ±rlanan sipariÅŸin durumunu manuel olarak deÄŸiÅŸtirme (Sadece bu fonksiyonu kullan)
```

---

#### ğŸ’° **Ã–DEME SÄ°STEMÄ° KRÄ°TÄ°K KURALLAR**
```javascript
// BU YAP - PARA ÃœSTÃœ HESAPLAMA
const calculateChange = (total, paid) => {
  // BU YAP - KUSURAT KONTROLÃœ
  const change = Number((paid - total).toFixed(2));
  return change >= 0 ? change : 0;
};

// BU YAP - Ã–DEME TAMAMLAMA
const completePayment = async (masaId, paymentType, amountPaid) => {
  const total = await calculateTotal(masaId);
  
  await supabase.from("odemeler").insert({
    masa_id: masaId,
    toplam_tutar: total,
    odeme_tipi: paymentType,
    alinan_tutar: amountPaid
  });

  // BU YAP - MASANIN SIFIRLANMASI
  await resetTable(masaId);
};

// BU YAPMA
// Ã–deme alÄ±nmadan masa durumunu deÄŸiÅŸtirme
```

---

#### ğŸ”„ **DURUM SENKRONÄ°ZASYONU (GerÃ§ek ZamanlÄ±)**
```javascript
// BU YAP - TÃœM PANELLER Ä°Ã‡Ä°N ORTAK YAPILANDIRMA
const setupRealtime = () => {
  // Masalar
  supabase
    .channel("tum-masalar")
    .on("postgres_changes", { event: "*", table: "masalar" }, updateAllTables)
    .subscribe();

  // SipariÅŸler
  supabase
    .channel("tum-siparisler")
    .on("postgres_changes", { event: "*", table: "siparisler" }, updateOrders)
    .subscribe();
};

// BU YAP - OFFLINE DESTEK
const syncOfflineChanges = async () => {
  if (navigator.onLine) {
    await pushLocalChanges(); // IndexedDB'den senkronizasyon
  }
};

// BU YAPMA
// Durum deÄŸiÅŸikliklerinde setTimeout/setInterval kullanma
```

---

#### ğŸ›¡ï¸ **GÃœVENLÄ°K KURALLARI (RLS)**
```sql
-- BU YAP - MASA TABLOSU Ä°Ã‡Ä°N
CREATE POLICY "Garson: Sadece durum gÃ¼ncelle"
ON masalar FOR UPDATE USING (
  current_user_role() = 'garson' AND
  (OLD.durum IN ('hazir', 'teslim_alindi') AND
  NEW.durum IN ('teslim_alindi', 'servis_edildi')
);

-- BU YAP - SÄ°PARÄ°Å TABLOSU Ä°Ã‡Ä°N
CREATE POLICY "Mutfak: Sadece bekleyen sipariÅŸler"
ON siparisler FOR SELECT USING (
  current_user_role() = 'mutfak' AND
  durum = 'bekliyor'
);

-- BU YAPMA
-- RLS'leri devre dÄ±ÅŸÄ± bÄ±rakma
```

---

#### ğŸ§ª **TEST KURALLARI (Zorunlu)**
```javascript
// BU YAP - TÃœM DURUM GEÃ‡Ä°ÅLERÄ°NÄ° TEST ET
test("Masa durum geÃ§iÅŸi: aktif -> hazir -> teslim_alindi -> servis_edildi -> bos", async () => {
  await testStateFlow([1, 2, 3, 4, 0]);
});

// BU YAP - GERÃ‡EK ZAMANLI GECÄ°KME TESTÄ°
test("Realtime gecikme 500ms altÄ±nda olmalÄ±", async () => {
  const start = Date.now();
  await triggerStateChange();
  expect(Date.now() - start).toBeLessThan(500);
});

// BU YAP - EK SÄ°PARÄ°Å SENARYOSU
test("Servis edilmiÅŸ masada ek sipariÅŸ", async () => {
  await setTableState(5, "servis_edildi");
  await addOrder(5, [/* yeni Ã¼rÃ¼nler */]);
  expect(await getKitchenOrders()).toContain(/* sadece yeni Ã¼rÃ¼nler */);
});

// BU YAPMA
// Ã–deme testlerinde gerÃ§ek para apileri kullanma
```

---

#### ğŸš« **KESÄ°NLÄ°KLE YAPILMAYACAKLAR**
1. **BU YAPMA** - Åifreleri plain text olarak loglama
2. **BU YAPMA** - Masa durumunu localStorage'da saklama
3. **BU YAPMA** - SipariÅŸ onaylama iÅŸlemini transaction dÄ±ÅŸÄ±nda yapma
4. **BU YAPMA** - GerÃ§ek zamanlÄ± kanallarÄ± gereksiz aÃ§Ä±k bÄ±rakma
5. **BU YAPMA** - Ã–deme hesaplarÄ±nda floating point kullanma (BigDecimal yerine)
6. **BU YAPMA** - UI refresh'leri iÃ§in polling kullanma (Sadece Realtime)

---

#### âœ… **ZORUNLU OPTÄ°MÄ°ZASYONLAR**
```sql
-- BU YAP - PERFORMANS Ä°NDEKSLERÄ°
CREATE INDEX idx_masalar_durum ON masalar(durum);
CREATE INDEX idx_siparisler_masa ON siparisler(masa_id, durum);

-- BU YAP - PARAMETRE OPTÄ°MÄ°ZASYONU
ALTER SYSTEM SET shared_buffers = "4GB";
ALTER SYSTEM SET effective_cache_size = "12GB";
```

```javascript
// BU YAP - FRONTEND PERFORMANS
const TableGrid = React.memo(({ tables }) => {
  // 100 masada virtual scroll kullan
  return <VirtualList items={tables} />;
});

// BU YAP - WEB WORKER Ä°LE HESAPLAMALAR
const worker = new Worker("payment.worker.js");
worker.postMessage({ total: 250, paid: 300 });
```

---

### ğŸ“¦ **Commit KurallarÄ±**
```bash
# BU YAP - ANLAMLI MESAJLAR
git commit -m "feat: Masa durum geÃ§iÅŸleri iÃ§in realtime kanal"
git commit -m "fix: Ek sipariÅŸ mutfak karÄ±ÅŸmasÄ± dÃ¼zeltme"

# BU YAPMA
git commit -m "bug fixes"
```

Bu kurallara kesinlikle uyularak geliÅŸtirme yapÄ±lmalÄ±dÄ±r. Her deÄŸiÅŸiklik sonrasÄ±:
1. TÃ¼m durum geÃ§iÅŸ testleri Ã§alÄ±ÅŸtÄ±rÄ±lacak
2. Realtime gecikme Ã¶lÃ§Ã¼lecek
3. RLS politikalarÄ± kontrol edilecek
4. Performans metriklere bakÄ±lacak

Proje baÅŸarÄ±sÄ± iÃ§in bu kurallar **VAZGEÃ‡Ä°LMEZDÄ°R**!